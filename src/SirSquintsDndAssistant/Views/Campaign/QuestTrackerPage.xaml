<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SirSquintsDndAssistant.ViewModels.Campaign"
             xmlns:models="clr-namespace:SirSquintsDndAssistant.Models.Campaign"
             x:Class="SirSquintsDndAssistant.Views.Campaign.QuestTrackerPage"
             x:DataType="vm:QuestTrackerViewModel"
             Title="{Binding Title}">
    <Grid RowDefinitions="Auto, *, *" Padding="10" RowSpacing="10">
        <Border Grid.Row="0" Padding="15" BackgroundColor="#F5F5F5" Stroke="#E0E0E0" StrokeThickness="1">
            <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
            <VerticalStackLayout Spacing="10">
                <Label Text="New Quest" FontSize="16" FontAttributes="Bold"/>
                <Entry Placeholder="Quest title" Text="{Binding NewQuestTitle}"/>
                <Entry Placeholder="Description" Text="{Binding NewQuestDescription}"/>
                <Button Text="Add Quest" Command="{Binding CreateQuestCommand}" BackgroundColor="#228B22" TextColor="White"/>
            </VerticalStackLayout>
        </Border>
        <VerticalStackLayout Grid.Row="1" Spacing="5">
            <Label Text="Active Quests" FontSize="16" FontAttributes="Bold"/>
            <CollectionView ItemsSource="{Binding ActiveQuests}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Quest">
                        <Border Padding="10" Margin="0,3" BackgroundColor="#90EE90" Stroke="#228B22" StrokeThickness="1">
                            <Border.StrokeShape><RoundRectangle CornerRadius="5"/></Border.StrokeShape>
                            <Grid ColumnDefinitions="*, Auto, Auto">
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="{Binding Title}" FontSize="14" FontAttributes="Bold"/>
                                    <Label Text="{Binding Description}" FontSize="12" TextColor="Gray"/>
                                </VerticalStackLayout>
                                <Button Grid.Column="1" Text="✓" WidthRequest="35" HeightRequest="35"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:QuestTrackerViewModel}}, Path=CompleteQuestCommand}"
                                        CommandParameter="{Binding .}" BackgroundColor="#228B22" TextColor="White" Margin="5,0"/>
                                <Button Grid.Column="2" Text="✕" WidthRequest="35" HeightRequest="35"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:QuestTrackerViewModel}}, Path=FailQuestCommand}"
                                        CommandParameter="{Binding .}" BackgroundColor="#DC143C" TextColor="White"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
        <VerticalStackLayout Grid.Row="2" Spacing="5">
            <Label Text="Completed Quests" FontSize="16" FontAttributes="Bold"/>
            <CollectionView ItemsSource="{Binding CompletedQuests}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Quest">
                        <Border Padding="10" Margin="0,3" BackgroundColor="#D3D3D3" Stroke="#808080" StrokeThickness="1">
                            <Border.StrokeShape><RoundRectangle CornerRadius="5"/></Border.StrokeShape>
                            <Label Text="{Binding Title}" FontSize="14" TextDecorations="Strikethrough"/>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
