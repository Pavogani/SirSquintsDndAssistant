<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SirSquintsDndAssistant.ViewModels.Settings"
             x:Class="SirSquintsDndAssistant.Views.Settings.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="{Binding Title}">

    <ScrollView Padding="20">
        <VerticalStackLayout Spacing="20">
            <!-- App Header -->
            <VerticalStackLayout Spacing="5" Margin="0,0,0,10">
                <Label Text="Sir Squintz's D&amp;D Assistant"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}"
                       HorizontalOptions="Center"/>
                <Label Text="{Binding AppVersion, StringFormat='Version {0}'}"
                       FontSize="14"
                       TextColor="{StaticResource Gray500}"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- D&D Beyond Import -->
            <Border Style="{StaticResource Card}"
                    BackgroundColor="{AppThemeBinding Light={StaticResource ParchmentLight}, Dark={StaticResource SurfaceCard}}"
                    Stroke="{StaticResource Tertiary}" StrokeThickness="2">
                <VerticalStackLayout Spacing="15">
                    <Label Text="D&amp;D Beyond Character Import" Style="{StaticResource SectionHeader}" Margin="0"/>
                    <Label Text="Enter character ID from URL" FontSize="12" TextColor="{StaticResource Gray500}"/>
                    <Label Text="Example: dndbeyond.com/characters/12345678" FontSize="11" TextColor="{StaticResource Gray400}"/>
                    <Entry Placeholder="Character ID" Text="{Binding CharacterId}" Keyboard="Numeric"/>
                    <Button Text="Import Character"
                            Command="{Binding ImportCharacterCommand}"
                            BackgroundColor="{StaticResource Tertiary}"
                            TextColor="{StaticResource White}"/>
                    <Label Text="{Binding ImportStatus}" FontSize="12" TextColor="{StaticResource Success}"/>
                    <Label Text="Uses unofficial API" FontSize="10" TextColor="{StaticResource Warning}"/>
                </VerticalStackLayout>
            </Border>

            <!-- Data Validation -->
            <Border Style="{StaticResource Card}"
                    BackgroundColor="{AppThemeBinding Light=#F0FFF0, Dark={StaticResource SurfaceCard}}"
                    Stroke="{StaticResource Success}" StrokeThickness="2">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Data Validation" Style="{StaticResource SectionHeader}" Margin="0"/>
                    <Label Text="Check data integrity and remove duplicates" FontSize="12" TextColor="{StaticResource Gray500}"/>
                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Validate Data"
                                Command="{Binding ValidateDataCommand}"
                                BackgroundColor="{StaticResource Success}"
                                TextColor="{StaticResource White}"
                                IsEnabled="{Binding IsValidating, Converter={StaticResource InvertedBoolConverter}}"/>
                        <Button Text="Remove Duplicates"
                                Command="{Binding RemoveDuplicatesCommand}"
                                Style="{StaticResource SecondaryButton}"
                                IsEnabled="{Binding IsValidating, Converter={StaticResource InvertedBoolConverter}}"/>
                    </HorizontalStackLayout>
                    <ActivityIndicator IsRunning="{Binding IsValidating}"
                                       IsVisible="{Binding IsValidating}"
                                       Color="{StaticResource Success}"/>
                    <Label Text="{Binding ValidationStatus}" FontSize="12" TextColor="{StaticResource Success}"/>
                </VerticalStackLayout>
            </Border>

            <!-- Backup & Restore -->
            <Border Style="{StaticResource Card}"
                    BackgroundColor="{AppThemeBinding Light=#FFF5E6, Dark={StaticResource SurfaceCard}}"
                    Stroke="{StaticResource Warning}" StrokeThickness="2">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Backup &amp; Restore" Style="{StaticResource SectionHeader}" Margin="0"/>
                    <Label Text="Export campaigns and encounters to JSON, or import from backup" FontSize="12" TextColor="{StaticResource Gray500}"/>
                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Export All"
                                Command="{Binding ExportAllDataCommand}"
                                BackgroundColor="{StaticResource Warning}"
                                TextColor="{StaticResource White}"
                                IsEnabled="{Binding IsExporting, Converter={StaticResource InvertedBoolConverter}}"/>
                        <Button Text="Import from File"
                                Command="{Binding ImportFromFileCommand}"
                                BackgroundColor="{StaticResource TypeAberration}"
                                TextColor="{StaticResource White}"
                                IsEnabled="{Binding IsExporting, Converter={StaticResource InvertedBoolConverter}}"/>
                    </HorizontalStackLayout>
                    <ActivityIndicator IsRunning="{Binding IsExporting}"
                                       IsVisible="{Binding IsExporting}"
                                       Color="{StaticResource Warning}"/>
                    <Label Text="{Binding ExportStatus}" FontSize="12" TextColor="{StaticResource Warning}"/>
                </VerticalStackLayout>
            </Border>

            <!-- Reset Data -->
            <Border Style="{StaticResource Card}"
                    BackgroundColor="{AppThemeBinding Light=#FFF0F0, Dark={StaticResource SurfaceCard}}"
                    Stroke="{StaticResource Danger}" StrokeThickness="2">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Reset Data" Style="{StaticResource SectionHeader}" Margin="0"/>
                    <Label Text="Clear all downloaded content and re-sync from D&amp;D 5e API" FontSize="12" TextColor="{StaticResource Gray500}"/>
                    <Button Text="Force Re-Download All Data"
                            Command="{Binding ForceResyncCommand}"
                            Style="{StaticResource DangerButton}"
                            IsEnabled="{Binding IsSyncing, Converter={StaticResource InvertedBoolConverter}}"/>
                    <ProgressBar Progress="{Binding SyncProgress}"
                                 IsVisible="{Binding IsSyncing}"
                                 ProgressColor="{StaticResource Danger}"/>
                    <Label Text="{Binding SyncStatus}"
                           FontSize="12"
                           TextColor="{StaticResource Danger}"
                           IsVisible="{Binding SyncStatus, Converter={StaticResource StringNotNullConverter}}"/>
                </VerticalStackLayout>
            </Border>

            <!-- Features List -->
            <Border Style="{StaticResource Card}" Margin="0,10,0,0">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Features" Style="{StaticResource SectionHeader}" Margin="0,0,0,8"/>
                    <Label Text="• 500+ Monsters from SRD and Open5e" FontSize="12"/>
                    <Label Text="• 300+ Spells with full descriptions" FontSize="12"/>
                    <Label Text="• Equipment and Magic Items" FontSize="12"/>
                    <Label Text="• Visual Battle Map with Fog of War" FontSize="12"/>
                    <Label Text="• Initiative Tracker with Death Saves" FontSize="12"/>
                    <Label Text="• Encounter Builder with CR Calculator" FontSize="12"/>
                    <Label Text="• Campaign and Session Manager" FontSize="12"/>
                    <Label Text="• Dice Roller and Random Generators" FontSize="12"/>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
